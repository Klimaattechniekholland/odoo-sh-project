<?xml version="1.0"?>
<odoo>
  <template id="report_invoice_custom">
    <t t-call="web.html_container">
      <t t-foreach="docs" t-as="doc">
        <t t-call="custom_sale_document.report_invoice_document" t-lang="doc.partner_id.lang"/>
      </t>
    </t>
  </template>

  <template id="report_invoice_document">
    <t t-call="web.external_layout">
      <div class="page">
        <h2>Invoice: <t t-esc="doc.name"/></h2>
        <p><strong>Customer:</strong> <t t-esc="doc.partner_id.name"/></p>
        <p><strong>Date:</strong> <t t-esc="doc.invoice_date or doc.date"/></p>
        <table class="table table-sm">
          <thead>
            <tr><th>Item</th><th>Qty</th><th>Unit Price</th><th>Taxes</th><th>Total</th></tr>
          </thead>
          <tbody>
            <tr t-foreach="doc.invoice_line_ids" t-as="line">
              <td><t t-esc="line.product_id.name"/></td>
              <td class="text-center"><t t-esc="line.quantity"/></td>
              <td class="text-right"><t t-field="line.price_unit" t-options="{'widget':'monetary','display_currency':doc.currency_id}"/></td>
              <td class="text-right"><t t-field="line.price_tax" t-options="{'widget':'monetary','display_currency':doc.currency_id}"/></td>
              <td class="text-right"><t t-field="line.price_subtotal" t-options="{'widget':'monetary','display_currency':doc.currency_id}"/></td>
            </tr>
            <tr t-if="doc.subsidy_amount">
              <td colspan="4" class="text-right"><strong>Subsidy:</strong></td>
              <td class="text-right"><t t-field="doc.subsidy_amount" t-options="{'widget':'monetary','display_currency':doc.currency_id}"/></td>
            </tr>
            <tr>
              <td colspan="4" class="text-right"><strong>Total:</strong></td>
              <td class="text-right"><t t-field="doc.amount_total" t-options="{'widget':'monetary','display_currency':doc.currency_id}"/></td>
            </tr>
          </tbody>
        </table>
        <div class="text-center" style="margin-top:20px;">
          <p>Scan to review/approve this invoice:</p>
          <img t-att-src="'/report/barcode/?barcode_type=QR&amp;value=%s' % doc.access_token" alt="QR Code" style="width:150px;height:150px;"/>
        </div>
      </div>
    </t>

    <t t-call="web.external_layout">
      <div class="page">
        <h3>Terms and Payment</h3>
        <p>Payment due by bank transfer within 30 days.</p>
        <t t-if="doc.invoice_variant == 'installation'">
          <h4>Installation Notes</h4>
          <p>This invoice covers the installation of the system.</p>
        </t>
        <t t-if="doc.invoice_variant == 'service'">
          <h4>Service Details</h4>
          <p>This invoice covers service and maintenance.</p>
        </t>
      </div>
    </t>
  </template>
</odoo>
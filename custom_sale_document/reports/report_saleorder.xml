<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Quotation Report Template -->
    <template id="report_saleorder_document" inherit_id="sale.report_saleorder_document" priority="100">
        <xpath expr="/t/t[@t-call='web.external_layout']" position="replace">

<!-- CONTEXT -->
            <t t-set="doc" t-value="doc.with_context(lang=doc.partner_id.lang)"/>
            <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
                <style>
                    body {
                        font-family: 'DejaVu Sans', Arial, sans-serif;
                        font-size: 13px;
                    }
                </style>
            <t t-set="company" t-value="doc.company_id"/>

            <!-- HEADER -->
            <div class="header o_company_#{company.id}_layout">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div t-if="company.report_header" t-field="company.report_header" class="o_company_tagline mw-50 fw-bold"/>
                    <img t-if="company.logo" class="o_company_logo_small ms-auto" t-att-src="image_data_uri(company.logo)" alt="Logo"/>
                </div>
            </div>

 <!-- PAGE 1: House Photo -->
            <div class="page" style="padding: 0px 30px; font-size: 18px; color: #263859; font-family: Arial, sans-serif;">

                <!-- Title Bar -->
                <div style="background-color: #003366; color: #ffffff; text-align: center; padding: 15px 0;">
                    <h2 style="margin: 0; font-size: 24px; font-weight: bold;">Offerte Details</h2>
                </div>

<!-- House Photo in Centered Container -->
<div style="width: 100%; text-align: center; margin: 20px 0;">
    <div style="
        margin: 0 auto;
        width: 100%;
        border: 2px solid #ddd;
        border-radius: 6px;
        background-color: #fafafa;
        overflow: hidden;
        box-sizing: border-box;">
        <div style="width: 100%; display: block;">
            <span t-field="doc.house_photo" 
                  t-options-widget="'image'" 
                  t-options-qweb_img_raw_data="1"
                  style="
                      width: 100%;
                      display: block;
                      object-fit: contain;"/>
        </div>
    </div>
</div>
            </div>

            <!-- PAGE 2: Quotation + Client Info -->
            <div style="page-break-before: always; padding: 40px; font-size: 18px; color: #263859; font-family: 'DejaVu Sans', Arial, sans-serif;">

                <!-- Quotation Meta -->
                <div style="border-left: 5px solid #003366; padding-left: 20px; margin-bottom: 30px;">
                    <h3 style="color: #003366; font-size: 20px;">Offerte Informatie</h3>
                    <table style="width: 100%; font-size: 16px; line-height: 1.8;">
                        <tr>
                            <td style="font-weight: bold;">Offertenummer:</td>
                            <td><span t-field="doc.name"/></td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold;">Datum:</td>
                            <td><span t-field="doc.date_order"/></td>
                        </tr>
                        <tr>
                            <td style="font-weight: bold;">Geldig t/m:</td>
                            <td><span t-field="doc.validity_date"/></td>
                        </tr>
                    </table>
                </div>

                <!-- Client Info -->
                <div style="border-left: 5px solid #F38821; padding-left: 20px;">
                    <h3 style="color: #F38821; font-size: 20px;">Klantgegevens</h3>
                    <p><span t-field="doc.partner_id.name"/></p>
                    <p t-if="doc.partner_id.street"><span t-field="doc.partner_id.street"/></p>
                    <p t-if="doc.partner_id.street2"><span t-field="doc.partner_id.street2"/></p>
                    <p t-if="doc.partner_id.city or doc.partner_id.zip">
                        <t t-if="doc.partner_id.city"><span t-field="doc.partner_id.city"/></t>,
                        <t t-if="doc.partner_id.zip"><span t-field="doc.partner_id.zip"/></t>
                    </p>
                    <p t-if="doc.partner_id.state_id"><span t-field="doc.partner_id.state_id.name"/></p>
                    <p t-if="doc.partner_id.country_id"><span t-field="doc.partner_id.country_id.name"/></p>
                </div>
                                <!-- System Description -->


                <h2 style="color: #003366; font-size: 24px; text-align: center; margin-bottom: 25px;">
                    Systeembeschrijving
                </h2>
                <div style="border-left: 6px solid #003366; padding-left: 20px; line-height: 1.8; text-align: justify;">
                    <span t-field="doc.system_description"/>
                </div>
            </div>



            <!-- PAGE 3: Quotation Lines -->
<div style="page-break-before: always; padding: 40px; font-size: 17px; color: #263859; font-family: 'DejaVu Sans', Arial, sans-serif;">
    <h2 style="text-align: center; color: #003366; font-size: 24px; margin-bottom: 25px;">
        Uw Voorstel
    </h2>

    <!-- Quotation Lines Table -->
    <table style="width: 100%; border-collapse: collapse; font-size: 16px;">
        <thead>
            <tr style="background-color: #F38821; color: #ffffff;">
                <th style="padding: 10px;">Omschrijving</th>
                <th style="padding: 10px; text-align: right;">Aantal</th>
                <th style="padding: 10px; text-align: right;">Prijs / stuk</th>
                <th style="padding: 10px; text-align: right;">BTW %</th>
                <th style="padding: 10px; text-align: right;">Totaal</th>
            </tr>
        </thead>
        <tbody>
            <t t-foreach="doc.order_line.filtered(lambda l: not l.display_type and not l.is_delivery and not l.is_downpayment and l.price_unit &gt; 0)" t-as="line">
                <tr style="border-bottom: 1px solid #ddd;">
                    <td style="padding: 8px;">
                        <span t-field="line.name"/>
                        <div t-if="line.product_id.description_sale" style="font-size: 13px; color: #666; margin-top: 3px;">
                            <span t-field="line.product_id.description_sale"/>
                        </div>
                    </td>
                    <td style="padding: 8px; text-align: right;">
                        <span t-field="line.product_uom_qty"/>
                    </td>
                    <td style="padding: 8px; text-align: right;">
                        <span t-field="line.price_unit" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                    </td>
                    <td style="padding: 8px; text-align: right;">
                        <t t-set="vat" t-value="line.tax_id and line.tax_id[0].amount"/>
                        <span t-esc="vat or '0.0'"/>%
                    </td>
                    <td style="padding: 8px; text-align: right;">
                        <span t-field="line.price_subtotal" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
                    </td>
                </tr>
            </t>
        </tbody>
    </table>

    <!-- Totals Section -->
    <div style="text-align: right; margin-top: 30px;">
        <p style="font-size: 18px;"><strong>Subtotaal:</strong> 
            <span t-field="doc.amount_untaxed" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
        </p>
        <p style="font-size: 18px;"><strong>BTW:</strong> 
            <span t-field="doc.amount_tax" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
        </p>
        <p style="font-size: 20px; color: #003366; font-weight: bold;">
            <strong>TOTAAL:</strong> 
            <span t-field="doc.amount_total" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
        </p>
    </div>

    <!-- Custom Fields Section -->
    <div style="
        margin-top: 40px;
        border-left: 5px solid #F38821;
        background-color: #fdfdfd;
        padding: 20px;
        border-radius: 6px;">
        <p style="font-size: 16px; margin-bottom: 8px;">
            <strong style="color: #F38821;">SUBSIDIEBEDRAG:</strong>
            <span t-field="doc.subsidy_amount" t-options="{'widget': 'monetary', 'display_currency': doc.currency_id}"/>
        </p>
        <p style="font-size: 16px;">
            <strong style="color: #F38821;">MELDCODE:</strong>
            <span t-field="doc.meldcode"/>
        </p>
    </div>
</div>




<!-- PAGE 4: Kits Marketing Text and Components -->
<div style="page-break-before: always; padding: 40px; font-family: 'DejaVu Sans', Arial, sans-serif; font-size: 15px; color: #263859;">

    <!-- Page Title -->
    <h2 style="text-align: center; font-size: 24px; margin-bottom: 35px; color: #003366; font-weight: bold;">
        Uw Klimaat Systeem Onderdelen
    </h2>

    <!-- Kits Loop -->
    <t t-if="doc.kit_bom_ids and len(doc.kit_bom_ids) > 0">
        <t t-foreach="doc.kit_bom_ids.filtered(lambda k: k.is_visible_in_quote)" t-as="kit">
            <!-- Kit Card -->
            <div style="
                border-left: 5px solid #F38821; 
                background-color: #fdfdfd; 
                border-radius: 8px; 
                padding: 25px; 
                margin-bottom: 40px;">

                <!-- Kit Name -->
                <h3 style="font-size: 20px; color: #F38821; margin-bottom: 20px;">
                    <span t-esc="kit.display_name"/>
                </h3>

                <!-- Kit Marketing Image -->
                <div t-if="kit.marketing_image" style="
                    text-align: center; 
                    margin-bottom: 20px;">
                    <span t-field="kit.marketing_image" 
                          t-options-widget="'image'" 
                          t-options-qweb_img_raw_data="1" 
                          style="
                            display: inline-block; 
                            max-width: 75%; 
                            max-height: 250px; 
                            object-fit: contain; 
                            border-radius: 6px; 
                            border: 1px solid #ddd;"/>
                </div>

                <!-- Kit Marketing Text -->
                <div t-if="kit.marketing_text" style="
                    line-height: 1.7; 
                    text-align: justify; 
                    margin-bottom: 25px;">
                    <span t-field="kit.marketing_text" t-options="{'widget': 'html'}"/>
                </div>

                <!-- Kit Components Table -->
                <t t-if="kit.bom_line_ids">
                    <h4 style="
                        font-size: 18px; 
                        color: #003366; 
                        margin-bottom: 10px;">
                        Onderdelen van dit systeem
                    </h4>
                    <table style="
                        width: 100%; 
                        border-collapse: collapse; 
                        font-size: 14px; 
                        margin-top: 10px;">
                        <thead>
                            <tr style="background-color: #F38821; color: #ffffff;">
                                <th style="padding: 10px; text-align: left;">Onderdeel</th>
                                <th style="padding: 10px; text-align: right;">Hoeveelheid</th>
                                <th style="padding: 10px; text-align: left;">Eenheid</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="kit.bom_line_ids" t-as="component">
                                <tr style="border-bottom: 1px solid #e0e0e0;">
                                    <td style="padding: 8px;">
                                        <span t-field="component.product_id.display_name"/>
                                    </td>
                                    <td style="padding: 8px; text-align: right;">
                                        <span t-field="component.product_qty"/>
                                    </td>
                                    <td style="padding: 8px;">
                                        <span t-field="component.product_uom_id.name"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </t>
            </div>
        </t>
    </t>

    <!-- Fallback Message -->
    <t t-if="not doc.kit_bom_ids or len(doc.kit_bom_ids.filtered(lambda k: k.is_visible_in_quote)) == 0">
        <div style="font-style: italic; color: #999; text-align: center; margin-top: 20px;">
            (Geen marketinginformatie voor kits beschikbaar)
        </div>
    </t>

</div>


            <!-- PAGE 5: Algemene Voorwaarden -->
<div style="page-break-before: always; padding: 40px 30px; font-family: 'DejaVu Sans', Arial, sans-serif; font-size: 16px; color: #263859; line-height: 1.6;">

    <!-- Title -->
    <h2 style="text-align: center; font-size: 22px; margin-bottom: 20px; color: #003366; font-weight: bold;">
        Algemene Voorwaarden
    </h2>

    <!-- Static Conditions Text -->
    <div style="text-align: justify;">
        <p>
            Met een klimaatsysteem van Klimaattechniek Holland bent u volledig ontzorgd. Bij ons geldt: afspraak = afspraak dus geen verrassingen achteraf. U bent verzekerd van een professioneel gecertificeerd montageteam dat zorg draagt voor een uitgekiende planning, duidelijke afspraken en snelle montage.
        </p>

        <h3 style="color: #F38821; font-size: 16px; margin-top: 20px;">Het Binnendeel</h3>
        <p>
            Het binnendeel is het deel van de installatie dat fysiek in de te conditioneren ruimte geplaatst wordt. Dit wordt ook wel de 'verdamper' genoemd. Het zuigt de lucht aan, koelt of verwarmt deze, en blaast deze gefilterd terug in de ruimte. Er wordt geen verse lucht toegevoerd of afgevoerd. 
        </p>

        <h3 style="color: #F38821; font-size: 16px; margin-top: 15px;">Het Buitendeel</h3>
        <p>
            Het buitendeel voert de gebruikte energie in de vorm van warmte of koude af. Afhankelijk van uw situatie wordt het buitendeel op het dak, aan de muur of op een speciale constructie geplaatst.
        </p>

        <h3 style="color: #F38821; font-size: 16px; margin-top: 15px;">Dakdoorvoer en Elektrische Voeding</h3>
        <p>
            Indien een dakdoorvoer nodig is voor de installatie, kunnen wij dit verzorgen. De elektrische aansluiting dient aanwezig te zijn of moet door een erkend installateur worden gerealiseerd.
        </p>

        <h3 style="color: #F38821; font-size: 16px; margin-top: 15px;">Inclusief</h3>
        <ul style="margin-left: 20px;">
            <li>Leveren en monteren van binnen- en buitenunits.</li>
            <li>Aansluiten van koelleidingen en bekabelingen tot 5 meter.</li>
            <li>Afwerking van bekabeling in kunststof kabelgoten.</li>
            <li>Opruimen van restmaterialen en afvoeren van afval.</li>
        </ul>

        <h3 style="color: #F38821; font-size: 16px; margin-top: 15px;">Exclusief</h3>
        <ul style="margin-left: 20px;">
            <li>Elektrische voeding / aansluiting extra groep.</li>
            <li>Verticaal transport (hijskraan).</li>
            <li>Bouwkundige en/of constructieve werkzaamheden.</li>
        </ul>

        <p style="margin-top: 20px;">
            Voor alle overige details en voorwaarden verwijzen wij naar de bijgevoegde Algemene Voorwaarden of onze website.
        </p>
    </div>
<!-- Customer Signature Section -->
<div style="margin-top: 50px; border-top: 2px solid #003366; padding-top: 15px;">
    <table style="width: 100%; font-size: 14px; color: #333;">
        <tr>
            <td style="width: 50%; vertical-align: top;">
                <h4 style="color: #003366; font-size: 15px; margin-bottom: 5px;">Customer Signature:</h4>

                <!-- Customer Signature Box -->
                <div style="border: 1px dashed #aaa; height: 80px; text-align: center; background-color: #f9f9f9;">
                    <t t-if="doc.signature">
                        <span t-field="doc.signature"
                              t-options-widget="'image'"
                              t-options-qweb_img_raw_data="1"
                              style="max-height: 70px; vertical-align: middle;"/>
                    </t>
                    <t t-else="">
                        <span style="color: #aaa; line-height: 80px;">(No signature)</span>
                    </t>
                </div>

                <p style="margin-top: 8px; font-style: italic; color: #555;">
                    Signed by: <span t-field="doc.signed_by"/><br/>
                    Date: <span t-field="doc.signed_on" t-options='{"widget": "datetime"}'/>
                </p>
            </td>

            <!-- Company Signature Box (Static Placeholder) -->
            <td style="width: 50%; vertical-align: top; text-align: right;">
                <h4 style="color: #003366; font-size: 15px; margin-bottom: 5px;">For Klimaattechniek Holland:</h4>

                <!-- Static placeholder -->
                <div style="border: 1px dashed #aaa; height: 80px; text-align: center; line-height: 80px; background-color: #f9f9f9;">
                    (Company Signature)
                </div>

                <p style="margin-top: 8px; font-style: italic; color: #555;">
                    Klimaattechniek Holland B.V.
                </p>
            </td>
        </tr>
    </table>
</div>

</div>





            <!-- FOOTER -->
            <div class="footer o_company_#{company.id}_layout" style="padding: 20px 50px;">
                <div class="o_footer_content text-center pt-2 small" style="color: #003366; font-size: 14px; font-weight: 500;">
                    <div>
                        <t t-esc="company.name + ' | ' + (company.street or '') + ' ' + (company.street2 or '') + ' | ' + (company.zip or '') + ' ' + (company.city or '')"/>
                    </div>
                    <div>
                        <t t-esc="(company.phone or '') + ' | ' + (company.email or '')"/>
                    </div>
                </div>
            </div>

        </xpath>
    </template>

</odoo>

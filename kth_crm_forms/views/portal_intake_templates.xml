<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!--
        Portal intake form template.

        This QWeb template renders a multi‑section form with tabs for
        Warmtepomp (heat pump), Airco, Service Contracts and Call‑Out.  A
        simple language toggle allows the user to switch between Dutch
        and English labels.  Basic bootstrap classes are used for
        responsiveness and aesthetics.  The form can be accessed from
        the portal by authenticated users.
    -->
    <template id="portal_intake_form" name="KTH CRM Intake Form">
        <t t-call="portal.portal_layout">
            <t t-set="title">Customer Intake</t>
            <div class="container my-5 p-4" style="max-width:950px; background:#F3F3F3; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
            <t t-set="company" t-value="request.env.company"/>

                <div class="header" style="padding: 20px; display: table; width: 100%; border-bottom: 3px solid #F38821; font-family: 'DejaVu Sans', Arial, sans-serif; color: #003366;">
                    <div style="display: table-row;">
                        <!-- Left: Company Info -->
                        <div style="display: table-cell; vertical-align: middle; text-align: left;">
                            <h2 style="margin: 0; font-size: 22px; font-weight: bold;">
                                <t t-if="company.name"><span t-esc="company.name"/></t>
                                <t t-else="">Klimaattechniek Holland B.V.</t>
                            </h2>
                            <p style="margin: 2px 0; font-size: 14px;">
                                <t t-if="company.street">
                                    <span t-esc="company.street"/>, <span t-esc="company.zip"/> <span t-esc="company.city"/>
                                </t>
                                <t t-else="">Keurenplein 4, 1069 CD Amsterdam</t>
                            </p>
                            <p style="margin: 2px 0; font-size: 14px;">
                                <t t-if="company.vat"><span t-esc="company.vat"/></t>
                                <t t-else="">NL866258802B01</t>
                                |
                                <t t-if="company.phone"><span t-esc="company.phone"/></t>
                                <t t-else="">085-0601051</t>
                            </p>
                            <p style="margin: 2px 0; font-size: 14px;">
                                <t t-if="company.bank_ids">
                                    <t t-foreach="company.bank_ids" t-as="bank">
                                        <span t-esc="bank.acc_number"/>
                                    </t>
                                </t>
                                <t t-else="">NL97INGB0105871834 | ABNANL2A</t>
                            </p>
                        </div>
                        <!-- Right: Logo -->
                        <div style="display: table-cell; vertical-align: middle; text-align: right;">
                            <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" style="height: 90px; max-height: 100px;" alt="Logo"/>
                        </div>
                    </div>
                </div>
                <div class="text-center mb-4">
                    <!-- Company logo -->
                    <h2 style="color:#2F7CB9; font-weight:600; margin-top:15px;">Intake Form</h2>
                    <!-- Language toggle -->
                    <div class="mt-2">
                        <button type="button" class="btn btn-sm btn-outline-primary me-1" onclick="toggleLang('en')">EN</button>
                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleLang('nl')">NL</button>
                    </div>
                </div>

                <!-- Display errors if any -->
                <t t-if="errors">
                    <div class="alert alert-danger" role="alert">
                        <ul class="mb-0">
                            <li t-foreach="errors" t-as="err"><t t-esc="err"/></li>
                        </ul>
                    </div>
                </t>

                <!-- Intake form -->
                <form action="/my/intake/submit" method="post" class="o_portal_intake">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>

                    <!-- Basic information fields, outside of tabs -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Full Name</label>
                            <input type="text" name="full_name" class="form-control" required="1" placeholder="John Doe" t-att-value="post.get('full_name') if post else ''"/>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Email</label>
                            <input type="email" name="email_from" class="form-control" required="1" placeholder="john@example.com" t-att-value="post.get('email_from') if post else ''"/>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Telephone/Mobile</label>
                            <input type="tel" name="phone" class="form-control" required="1" placeholder="0612345678" t-att-value="post.get('phone') if post else ''"/>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Address</label>
                            <input type="text" name="address" class="form-control" required="1" placeholder="Street 1" t-att-value="post.get('address') if post else ''"/>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <label class="form-label">Zip</label>
                            <input type="text" name="zip_code" class="form-control" placeholder="1234AB" t-att-value="post.get('zip_code') if post else ''"/>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">House Number</label>
                            <input type="text" name="house_number" class="form-control" placeholder="12" t-att-value="post.get('house_number') if post else ''"/>
                        </div>
                    </div>

                    <!-- Tab navigation -->
                    <ul class="nav nav-tabs mb-3" id="intakeTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="heatpump-tab" data-bs-toggle="tab" href="#heatpump" role="tab" aria-controls="heatpump" aria-selected="true">Heat Pump</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="airco-tab" data-bs-toggle="tab" href="#airco" role="tab" aria-controls="airco" aria-selected="false">Airco</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="service-tab" data-bs-toggle="tab" href="#service" role="tab" aria-controls="service" aria-selected="false">Service Contract</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="callout-tab" data-bs-toggle="tab" href="#callout" role="tab" aria-controls="callout" aria-selected="false">Call‑Out</a>
                        </li>
                    </ul>

                    <div class="tab-content" id="intakeTabsContent">
                        <!-- Heat Pump tab -->
                        <div class="tab-pane fade show active" id="heatpump" role="tabpanel" aria-labelledby="heatpump-tab">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label">Type System</label>
                                    <select name="type_system" class="form-select" t-att-value="post.get('type_system') if post else ''">
                                        <option value="">--</option>
                                        <option value="hybrid">Hybride</option>
                                        <option value="all_electric_ready">All Electric Ready</option>
                                        <option value="all_electric">All Electric</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Brand</label>
                                    <select name="brand" class="form-select" t-att-value="post.get('brand') if post else ''">
                                        <option value="">--</option>
                                        <option value="vaillant">Vaillant</option>
                                        <option value="viessmann">Viessmann</option>
                                        <option value="weheat">WeHeat</option>
                                        <option value="remeha">Remeha</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Floor Surface (m²)</label>
                                    <input type="number" name="floor_surface" class="form-control" min="0" t-att-value="post.get('floor_surface') if post else ''"/>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label">Type Heating</label>
                                    <select name="type_heating" class="form-select" t-att-value="post.get('type_heating') if post else ''">
                                        <option value="">--</option>
                                        <option value="floor_radiators">Vloerverwarming + Radiatoren</option>
                                        <option value="floor_only">Alleen Vloerverwarming</option>
                                        <option value="radiators_only">Alleen Radiatoren</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Gas Consumption (m³/yr)</label>
                                    <input type="number" name="gas_consumption" class="form-control" min="0" t-att-value="post.get('gas_consumption') if post else ''"/>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Energy Label</label>
                                    <select name="energy_label" class="form-select" t-att-value="post.get('energy_label') if post else ''">
                                        <option value="">--</option>
                                        <option value="a++++">A++++</option>
                                        <option value="a+++">A+++</option>
                                        <option value="a++">A++</option>
                                        <option value="a+">A+</option>
                                        <option value="b">B</option>
                                        <option value="c">C</option>
                                        <option value="d">D</option>
                                        <option value="e">E</option>
                                        <option value="f">F</option>
                                        <option value="g">G</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label">Year Built</label>
                                    <input type="number" name="year_built" class="form-control" min="1800" max="2100" t-att-value="post.get('year_built') if post else ''"/>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Ventilation</label>
                                    <select name="ventilation" class="form-select" t-att-value="post.get('ventilation') if post else ''">
                                        <option value="">--</option>
                                        <option value="a">Type A</option>
                                        <option value="b">Type B</option>
                                        <option value="c">Type C</option>
                                        <option value="d">Type D (WtW)</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label">Members</label>
                                    <input type="number" name="members" class="form-control" min="1" t-att-value="post.get('members') if post else ''"/>
                                </div>
                            </div>
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label class="form-label">Average Usage</label>
                                    <select name="average_usage" class="form-select" t-att-value="post.get('average_usage') if post else ''">
                                        <option value="">--</option>
                                        <option value="economic">Economisch</option>
                                        <option value="standard">Standaard</option>
                                        <option value="luxury">Luxe</option>
                                    </select>
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label">Extra Notes</label>
                                    <textarea name="extra_notes" rows="2" class="form-control" placeholder="Any additional information"> <t t-esc="post.get('extra_notes') if post else ''"/> </textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Airco tab -->
                        <div class="tab-pane fade" id="airco" role="tabpanel" aria-labelledby="airco-tab">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Airco Model</label>
                                    <input type="text" name="airco_model" class="form-control" placeholder="Model" t-att-value="post.get('airco_model') if post else ''"/>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Airco Capacity (kW)</label>
                                    <input type="number" name="airco_capacity" class="form-control" min="0" t-att-value="post.get('airco_capacity') if post else ''"/>
                                </div>
                            </div>
                        </div>

                        <!-- Service Contract tab -->
                        <div class="tab-pane fade" id="service" role="tabpanel" aria-labelledby="service-tab">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Service Contract Type</label>
                                    <select name="service_contract_type" class="form-select" t-att-value="post.get('service_contract_type') if post else ''">
                                        <option value="">--</option>
                                        <option value="bronze">Bronze</option>
                                        <option value="silver">Silver</option>
                                        <option value="gold">Gold</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Call‑Out tab -->
                        <div class="tab-pane fade" id="callout" role="tabpanel" aria-labelledby="callout-tab">
                            <div class="mb-3">
                                <label class="form-label">Problem Description</label>
                                <textarea name="callout_issue" rows="3" class="form-control" placeholder="Describe the issue" t-att-value="post.get('callout_issue') if post else ''"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Submit button -->
                    <div class="text-center mt-4">
                        <button type="submit" class="btn" style="background:#2F7CB9; color:#fff; border-radius:8px; padding:10px 24px;">
                            Submit Intake
                        </button>
                    </div>
                </form>
            </div>
            <!-- Language toggle script: simply sets lang attribute -->
            <script type="text/javascript">
                function toggleLang(lang) {
                    document.documentElement.lang = lang;
                }
            </script>
        </t>
    </template>

    <!-- Success page -->
    <template id="portal_intake_success" name="KTH CRM Intake Success">
        <t t-call="portal.portal_layout">
            <div class="container my-5 p-5 text-center">
                <h2 style="color:#2F7CB9;">Thank you!</h2>
                <p>Your intake form has been received successfully.</p>
            </div>
        </t>
    </template>
</odoo>
